
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>RSKtools for Matlab access to RBR data</title><meta name="generator" content="MATLAB 8.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-07-07"><meta name="DC.source" content="RSKtools_vignette.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>RSKtools for Matlab access to RBR data</h1><!--introduction--><p>RSKtools v2.0.0; RBR Ltd. Ottawa ON, Canada; <a href="mailto:support@rbr-global.com">support@rbr-global.com</a>; 2017-07-07</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#2">Installing</a></li><li><a href="#3">Examples of use</a></li><li><a href="#7">Working with profiles</a></li><li><a href="#8">Customising plots</a></li><li><a href="#9">See RSKtools_vignette2</a></li><li><a href="#10">Future plans</a></li><li><a href="#11">About this document</a></li></ul></div><h2>Introduction<a name="1"></a></h2><p><tt>RSKtools</tt> provides some convenience functions for common data extraction (e.g., extracting profiles from a continuous dataset) and visualisation (e.g., plotting individual profiles). New in v2.0.0 are a suite of functions to perform routine processing steps to enhance the data quality (see RSKtools_vignette2 for more information). From this version on, we are expanding our data post-processing suite. See the Future Plans for some ideas, and please feel free to make suggestions.</p><h2>Installing<a name="2"></a></h2><p>The latest stable version of <tt>RSKtools</tt> can be found at <a href="http://www.rbr-global.com/support/matlab-tools">http://www.rbr-global.com/support/matlab-tools</a>.</p><div><ul><li>Unzip the archive (to <tt>~/matlab/RSKtools</tt>, for instance)</li><li>Add the folder to your path from the command line (<tt>addpath ~/matlab/RSKtools</tt>) or launch the path editor gui (<tt>pathtool</tt>).</li><li>type <tt>help RSKtools</tt> to get an overview and take a look at the examples.</li></ul></div><h2>Examples of use<a name="3"></a></h2><p><h3>Loading files</h3></p><p>A connection to the database must be made to work with an RSK file using <tt>RSKtools</tt>. This connection is made using the <tt>RSKopen()</tt> function. Note that <tt>RSKopen</tt> does not actually read the data, but reads a /thumbnail/ of the data, which is up to 4000 samples long. The structure returned after opening an RSK looks something like:</p><pre class="codeinput">file = <span class="string">'sample.rsk'</span>;
rsk = RSKopen(file)
</pre><pre class="codeoutput">rsk = 
                dbInfo: [1x1 struct]
    instrumentChannels: [7x1 struct]
              channels: [7x1 struct]
                epochs: [1x1 struct]
             schedules: [1x1 struct]
           deployments: [1x1 struct]
           instruments: [1x1 struct]
           appSettings: [1x1 struct]
               ranging: [7x1 struct]
            continuous: [1x1 struct]
            parameters: [1x1 struct]
         parameterKeys: [23x1 struct]
         thumbnailData: [1x1 struct]
                region: [762x1 struct]
            regionCast: [508x1 struct]
              profiles: [1x1 struct]
                   log: {[7.3688e+05]  'sample.rsk opened using RSKtools v2...'}
</pre><p>To read the actual data, use the <tt>RSKreaddata</tt> function. If given with one input argument (the variable name of the RSK structure) it will read the entire data set. Because RSK files can store a large amount of data, it may be preferable to read a subset of the data, specified using a start and end time (in Matlab <tt>datenum</tt> format, which is defined as the number of days since January 0, 0000).</p><pre class="codeinput">t1 = datenum(2014, 05, 03);
t2 = datenum(2014, 05, 04);
rsk = RSKreaddata(rsk, <span class="string">'t1'</span>, t1, <span class="string">'t2'</span>, t2);
</pre><p>Note that the logger data can be found in the structure at:</p><pre class="codeinput">rsk.data
</pre><pre class="codeoutput">ans = 
    tstamp: [22346x1 double]
    values: [22346x7 double]
</pre><p>In this example, because the instrument is a "CTD"-type instrument, Practical Salinity can be derived from conductivity, temperature, and pressure. <tt>RSKderivesalinity</tt> is a wrapper for the TEOS-10 GSW function <tt>gsw_SP_from_C</tt>, and it adds a new channel called <tt>Salinity</tt> as a column in <tt>rsk.data.values</tt>.  The TEOS-10 GSW Matlab toolbox is freely available from  <a href="http://teos-10.org/software.htm">http://teos-10.org/software.htm</a>.</p><pre class="codeinput">rsk = RSKderivesalinity(rsk);
rsk.channels.longName
</pre><pre class="codeoutput">ans =
Conductivity
ans =
Temperature
ans =
Pressure
ans =
Dissolved O2
ans =
Turbidity
ans =
PAR
ans =
Chlorophyll
ans =
Salinity
</pre><h2>Working with profiles<a name="7"></a></h2><p>Profiling loggers with recent versions of firmware contain the ability to detect and log profile "events" automatically; these are denoted as "downcasts" and "upcasts". The function <tt>RSKreadprofiles</tt> extracts individual profiles from the raw data, based on the previously identified profiling events. Then, plots of the profiles can be made using the <tt>RSKplotprofiles</tt> function.</p><p>If profiles have not been detected by the logger or Ruskin, the function <tt>RSKfindprofiles</tt> can be used. The pressureThreshold argument, which determines the pressure reversal required to trigger a new profile, and the conductivityThreshold argument, which determines if the logger is out of the water, can be adjusted to improve profile detection when the profiles are very shallow, or the water is very fresh.</p><pre class="codeinput"><span class="comment">% load the second to tenth profiles in both directions (upcast and downcast)</span>
rsk = RSKreadprofiles(rsk, <span class="string">'profile'</span>, 2:10, <span class="string">'direction'</span>, <span class="string">'both'</span>);
rsk = RSKderivesalinity(rsk);

<span class="comment">% plot the upcasts of conductivity, temperature, and salinity</span>
handles = RSKplotprofiles(rsk, <span class="string">'channel'</span>, {<span class="string">'conductivity'</span>, <span class="string">'temperature'</span>,<span class="string">'salinity'</span>}, <span class="string">'direction'</span>, <span class="string">'up'</span>);
</pre><img vspace="5" hspace="5" src="RSKtools_vignette_01.png" alt=""> <h2>Customising plots<a name="8"></a></h2><p>All plotting functions return a handle which enables access to the lines in the plot. The output is a matrix containing a column for each channel subplot and a row for each profile.</p><pre class="codeinput">handles

<span class="comment">% To increase the linewidth of the first profile in all subplots</span>
set(handles(1,:),{<span class="string">'linewidth'</span>},{5});
</pre><pre class="codeoutput">handles = 
  9x3 Line array:

    Line    Line    Line
    Line    Line    Line
    Line    Line    Line
    Line    Line    Line
    Line    Line    Line
    Line    Line    Line
    Line    Line    Line
    Line    Line    Line
    Line    Line    Line
</pre><img vspace="5" hspace="5" src="RSKtools_vignette_02.png" alt=""> <h2>See RSKtools_vignette2<a name="9"></a></h2><p>A second vignette is available for information on getting started with post-processing functions.</p><h2>Future plans<a name="10"></a></h2><div><ul><li>Function to write metadata, log and data to a file.</li><li>Wave processing functions.</li><li>Function to plot temperature-salinity diagrams.</li></ul></div><h2>About this document<a name="11"></a></h2><p>This document was created using <a href="http://www.mathworks.com/help/matlab/matlab_prog/marking-up-matlab-comments-for-publishing.html">Matlab&#8482; Markup Publishing</a>. To publish it as an HTML page, run the command:</p><pre class="language-matlab">publish(<span class="string">'RSKtools_vignette.m'</span>);
</pre><p>See <tt>help publish</tt> for more document export options.</p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2015b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% RSKtools for Matlab access to RBR data
% RSKtools v2.0.0;
% RBR Ltd. Ottawa ON, Canada;
% support@rbr-global.com;
% 2017-07-07

%% Introduction 
% |RSKtools| provides some convenience functions for common data extraction
% (e.g., extracting profiles from a continuous dataset) and visualisation
% (e.g., plotting individual profiles). New in v2.0.0 are a suite of
% functions to perform routine processing steps to enhance the data quality
% (see RSKtools_vignette2 for more information). From this version on, we
% are expanding our data post-processing suite. See the Future Plans for
% some ideas, and please feel free to make suggestions.

%% Installing
% The latest stable version of |RSKtools| can be found at <http://www.rbr-global.com/support/matlab-tools>.
% 
% * Unzip the archive (to |~/matlab/RSKtools|, for instance) 
% * Add the folder to your path from the command line (|addpath ~/matlab/RSKtools|) or launch the path editor gui (|pathtool|). 
% * type |help RSKtools| to get an overview and take a look at the examples.

  
%% Examples of use
% <html><h3>Loading files</h3></html>
% 
% A connection to the database must be made to work with an RSK file using
% |RSKtools|. This connection is made using the |RSKopen()| function. Note
% that |RSKopen| does not actually read the data, but reads a /thumbnail/ of
% the data, which is up to 4000 samples long. The structure returned after
% opening an RSK looks something like:

file = 'sample.rsk';
rsk = RSKopen(file)

%%
% To read the actual data, use the |RSKreaddata| function. If given
% with one input argument (the variable name of the RSK structure) it will
% read the entire data set. Because RSK files can store a large amount of 
% data, it may be preferable to read a subset of the data, specified using
% a start and end time (in Matlab |datenum| format, which is defined as the
% number of days since January 0, 0000). 

t1 = datenum(2014, 05, 03);
t2 = datenum(2014, 05, 04);
rsk = RSKreaddata(rsk, 't1', t1, 't2', t2);

%%
% Note that the logger data can be found in the structure at:

rsk.data        

%% 
% In this example, because the instrument is a "CTD"-type instrument, 
% Practical Salinity can be derived from conductivity, temperature, and pressure.
% |RSKderivesalinity| is a wrapper for the TEOS-10 GSW function
% |gsw_SP_from_C|, and it adds a new channel called |Salinity| as a column
% in |rsk.data.values|.  The TEOS-10 GSW Matlab toolbox is freely available
% from  <http://teos-10.org/software.htm>.

rsk = RSKderivesalinity(rsk);
rsk.channels.longName

%% Working with profiles
% Profiling loggers with recent versions of firmware contain the
% ability to detect and log profile "events" automatically; these are
% denoted as "downcasts" and "upcasts". The function |RSKreadprofiles|
% extracts individual profiles from the raw data, based on the previously
% identified profiling events. Then, plots of the profiles can be
% made using the |RSKplotprofiles| function.
%
% If profiles have not been detected by the logger or Ruskin, the function
% |RSKfindprofiles| can be used. The pressureThreshold argument, which
% determines the pressure reversal required to trigger a new profile, and
% the conductivityThreshold argument, which determines if the logger is
% out of the water, can be adjusted to improve profile detection when 
% the profiles are very shallow, or the water is very fresh.

% load the second to tenth profiles in both directions (upcast and downcast)
rsk = RSKreadprofiles(rsk, 'profile', 2:10, 'direction', 'both');
rsk = RSKderivesalinity(rsk);

% plot the upcasts of conductivity, temperature, and salinity
handles = RSKplotprofiles(rsk, 'channel', {'conductivity', 'temperature','salinity'}, 'direction', 'up');



%% Customising plots
% All plotting functions return a handle which enables access to the lines
% in the plot. The output is a matrix containing a column for each
% channel subplot and a row for each profile. 
handles

% To increase the linewidth of the first profile in all subplots
set(handles(1,:),{'linewidth'},{5});

%% See RSKtools_vignette2
% A second vignette is available for information on getting started with
% post-processing functions.

%% Future plans
% * Function to write metadata, log and data to a file.
% * Wave processing functions.
% * Function to plot temperature-salinity diagrams.

%% About this document
% This document was created using
% <http://www.mathworks.com/help/matlab/matlab_prog/marking-up-matlab-comments-for-publishing.html
% Matlab(TM) Markup Publishing>. To publish it as an HTML page, run the
% command:
%%
% 
%   publish('RSKtools_vignette.m');

%%
% See |help publish| for more document export options.
##### SOURCE END #####
--></body></html>