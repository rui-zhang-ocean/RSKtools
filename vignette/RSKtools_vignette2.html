
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>RSKtools for Matlab processing RBR data</title><meta name="generator" content="MATLAB 8.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-07-07"><meta name="DC.source" content="RSKtools_vignette2.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>RSKtools for Matlab processing RBR data</h1><!--introduction--><p>RSKtools v2.0.0; RBR Ltd. Ottawa ON, Canada; <a href="mailto:support@rbr-global.com">support@rbr-global.com</a>; 2017-07-06</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#2">Getting set up</a></li><li><a href="#3">Low-pass filtering</a></li><li><a href="#5">Aligning CT</a></li><li><a href="#6">Remove loops</a></li><li><a href="#7">Derive</a></li><li><a href="#8">Bin data</a></li><li><a href="#9">Plot</a></li><li><a href="#10">See RSKtools_vignette</a></li><li><a href="#11">About this document</a></li></ul></div><h2>Introduction<a name="1"></a></h2><p>A suite of new functions are included in RSKtools v2.0.0 to post-process RBR logger data. Below we show how to implement some common processing steps to obtain the highest quality data possible.</p><h2>Getting set up<a name="2"></a></h2><p>See review RSKtools_vignette for help.</p><pre class="codeinput">file = <span class="string">'sample.rsk'</span>;
rsk = RSKopen(file);
rsk = RSKreadprofiles(rsk, <span class="string">'profile'</span>, 10:55, <span class="string">'direction'</span>, <span class="string">'up'</span>);
</pre><h2>Low-pass filtering<a name="3"></a></h2><p>The first step is generally to apply a low pass filter to the pressure data; then filter the temperature and conductivity channels to smooth high frequency variability and match sensor time constants. RSKtools includes a function called <tt>RSKsmooth</tt> for this purpose. All post-processing functions are customizable with name-value pair input arguments.  To process all data using the default parameters no name-value pair arguments are required. All the information above is available for each function using <tt>help</tt>, for example: <tt>help RSKsmooth</tt>.</p><pre class="codeinput">help <span class="string">RSKsmooth</span>
</pre><pre class="codeoutput"> RSKsmooth - Apply a low pass filter on specified channels.
 
  Syntax:  [RSK] = RSKsmooth(RSK, channel, [OPTIONS])
  
  Low-pass filter a specified channel or multiple channels with a
  running average or median.  The sample being evaluated is always in
  the centre of the filtering window to avoid phase distortion.  Edge
  effects are handled by mirroring the original time series.
 
  Inputs: 
     [Required] - RSK - Structure containing the logger data.
 
                  channel - Longname of channel to filter. Can be a 
                        single channel, a cell array for multiple 
                        channels, or 'all' for all channels.
                
     [Optional] - filter - The weighting function, 'boxcar' or 'triangle'.
                        Use 'median' to compute the running median. 
                        Defaults to 'boxcar.'
 
                  profile - Profile number. Defaults to operate on all
                        available profiles.  
 
                  direction - 'up' for upcast, 'down' for downcast, or
                        'both' for all. Defaults to all directions available.
 
                  windowLength - The total size of the filter window. Must
                        be odd. Default is 3.
 
  Outputs:
     RSK - Structure with filtered values.
 
  Example: 
     rsk = RSKopen('file.rsk');
     rsk = RSKreadprofiles(rsk, 'profile', 1:10); % read first 10 downcasts
     rsk = RSKsmooth(rsk, {'Temperature', 'Salinity'}, 'windowLength', 17);
 
  Author: RBR Ltd. Ottawa ON, Canada
  email: support@rbr-global.com
  Website: www.rbr-global.com
  Last revision: 2017-06-28

</pre><pre class="codeinput">rsk = RSKsmooth(rsk, <span class="string">'Pressure'</span>);
rsk = RSKsmooth(rsk, {<span class="string">'Conductivity'</span>, <span class="string">'Temperature'</span>}, <span class="string">'windowLength'</span>, 21);
</pre><h2>Aligning CT<a name="5"></a></h2><p>RSKtools provides a function called <tt>RSKcalculateCTlag</tt> that estimates the optimal lag between conductivity and temperature by minimising salinity spiking. See <tt>help RSKcalculateCTlag</tt>.</p><pre class="codeinput">lag = RSKcalculateCTlag(rsk);
rsk = RSKalignchannel(rsk, <span class="string">'Conductivity'</span>, lag);
</pre><pre class="codeoutput">Processing cast: 1
Processing cast: 2
Processing cast: 3
Processing cast: 4
Processing cast: 5
Processing cast: 6
Processing cast: 7
Processing cast: 8
Processing cast: 9
Processing cast: 10
Processing cast: 11
Processing cast: 12
Processing cast: 13
Processing cast: 14
Processing cast: 15
Processing cast: 16
Processing cast: 17
Processing cast: 18
Processing cast: 19
Processing cast: 20
Processing cast: 21
Processing cast: 22
Processing cast: 23
Processing cast: 24
Processing cast: 25
Processing cast: 26
Processing cast: 27
Processing cast: 28
Processing cast: 29
Processing cast: 30
Processing cast: 31
Processing cast: 32
Processing cast: 33
Processing cast: 34
Processing cast: 35
Processing cast: 36
Processing cast: 37
Processing cast: 38
Processing cast: 39
Processing cast: 40
Processing cast: 41
Processing cast: 42
Processing cast: 43
Processing cast: 44
Processing cast: 45
Processing cast: 46
</pre><h2>Remove loops<a name="6"></a></h2><p>Profiling during rough seas can cause the CTD descent (or ascent) rate to vary, or even temporarily reverse direction, while profiling.  During such times, the CTD can effectively sample its own wake, potentially degrading the quality of the profile in regions of strong gradients. The measurements taken too slowly or during a pressure reversal should not be used for further analysis. We recommend using <tt>RSKremoveloops</tt> to flag and remove data when the instrument falls below a <tt>threshold</tt> speed.  This function requires a depth channel, for which we have provided <tt>RSKderivedepth</tt>.</p><pre class="codeinput">rsk = RSKderivedepth(rsk);
rsk = RSKremoveloops(rsk, <span class="string">'threshold'</span>, 0.3);
</pre><h2>Derive<a name="7"></a></h2><p>Functions are provided to derive sea pressure, practical salinity, and depth from measured channels. We suggest deriving sea pressure first, especially when an atmospheric pressure other than the nominal value of 10.1325 dbar is used, because deriving salinity and depth requires sea pressure.</p><pre class="codeinput">rsk = RSKderiveseapressure(rsk);
rsk = RSKderivesalinity(rsk);
rsk = RSKderivedepth(rsk);
</pre><h2>Bin data<a name="8"></a></h2><p>Average the data into 0.5 dbar bins using <tt>RSKbinaverage</tt>.</p><pre class="codeinput">rsk = RSKbinaverage(rsk, <span class="string">'binBy'</span>, <span class="string">'Sea Pressure'</span>, <span class="string">'binSize'</span>, 0.5, <span class="string">'direction'</span>, <span class="string">'up'</span>);
</pre><h2>Plot<a name="9"></a></h2><p>Now we can see the changes to the data. We suggest plotting as you go to see if the changes being applied are what you expect.</p><pre class="codeinput">RSKplot2D(rsk, <span class="string">'Salinity'</span>);
</pre><img vspace="5" hspace="5" src="RSKtools_vignette2_01.png" alt=""> <h2>See RSKtools_vignette<a name="10"></a></h2><p>A vignette is available for information on getting started with <tt>RSKtools</tt> standard functions.</p><h2>About this document<a name="11"></a></h2><p>This document was created using <a href="http://www.mathworks.com/help/matlab/matlab_prog/marking-up-matlab-comments-for-publishing.html">Matlab&#8482; Markup Publishing</a>. To publish it as an HTML page, run the command:</p><pre class="language-matlab">publish(<span class="string">'RSKtools_vignette.m'</span>);
</pre><p>See <tt>help publish</tt> for more document export options.</p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2015b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% RSKtools for Matlab processing RBR data
% RSKtools v2.0.0;
% RBR Ltd. Ottawa ON, Canada;
% support@rbr-global.com;
% 2017-07-06

%% Introduction
% A suite of new functions are included in RSKtools v2.0.0 
% to post-process RBR logger data. Below we show how
% to implement some common processing steps to obtain the highest
% quality data possible. 

%% Getting set up
% See review RSKtools_vignette for help.
file = 'sample.rsk';
rsk = RSKopen(file);
rsk = RSKreadprofiles(rsk, 'profile', 10:55, 'direction', 'up');

%% Low-pass filtering
% The first step is generally to apply a low pass filter to the pressure
% data; then filter the temperature and conductivity channels to
% smooth high frequency variability and match sensor time constants. 
% RSKtools includes a function called
% |RSKsmooth| for this purpose. All post-processing functions are customizable
% with name-value pair input arguments.  To process all data using the default parameters no
% name-value pair arguments are required. 
% All the information above is available for each function using |help|, for example: |help
% RSKsmooth|.
help RSKsmooth

%%
rsk = RSKsmooth(rsk, 'Pressure');
rsk = RSKsmooth(rsk, {'Conductivity', 'Temperature'}, 'windowLength', 21);

%% Aligning CT
% RSKtools provides a function called |RSKcalculateCTlag| that estimates
% the optimal lag between conductivity and temperature by minimising salinity
% spiking. See |help RSKcalculateCTlag|.
lag = RSKcalculateCTlag(rsk);
rsk = RSKalignchannel(rsk, 'Conductivity', lag);

%% Remove loops
% Profiling during rough seas can cause the CTD descent (or ascent) rate to vary, or even
% temporarily reverse direction, while profiling.  During such times, the 
% CTD can effectively sample its own wake, potentially degrading the quality
% of the profile in regions of strong gradients. The measurements taken too slowly or
% during a pressure reversal should not be used for further analysis. We
% recommend using |RSKremoveloops| to flag and remove data when the instrument falls
% below a |threshold| speed.  This function requires a depth channel, for
% which we have provided |RSKderivedepth|.
rsk = RSKderivedepth(rsk);
rsk = RSKremoveloops(rsk, 'threshold', 0.3);

%% Derive
% Functions are provided to derive sea pressure,
% practical salinity, and depth from measured channels. We suggest deriving sea pressure first, 
% especially when an atmospheric pressure other than the nominal value of 10.1325 dbar
% is used, because deriving salinity and depth requires sea pressure.
rsk = RSKderiveseapressure(rsk);
rsk = RSKderivesalinity(rsk);
rsk = RSKderivedepth(rsk);

%% Bin data
% Average the data into 0.5 dbar bins using |RSKbinaverage|.
rsk = RSKbinaverage(rsk, 'binBy', 'Sea Pressure', 'binSize', 0.5, 'direction', 'up');

%% Plot 
% Now we can see the changes to the data. We suggest plotting as you go to 
% see if the changes being applied are what you expect. 
RSKplot2D(rsk, 'Salinity'); 


%% See RSKtools_vignette
% A vignette is available for information on getting started with
% |RSKtools| standard functions.


%% About this document
% This document was created using
% <http://www.mathworks.com/help/matlab/matlab_prog/marking-up-matlab-comments-for-publishing.html
% Matlab(TM) Markup Publishing>. To publish it as an HTML page, run the
% command:
%%
% 
%   publish('RSKtools_vignette.m');

%%
% See |help publish| for more document export options.
##### SOURCE END #####
--></body></html>